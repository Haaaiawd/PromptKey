# Concept Model - Quick Selection Panel

*Generated by: SCOUT (Phase: Step 5 - Concept Modeling)*  
*Date: 2025-12-27*  
*Feature: å¿«é€Ÿé€‰æ‹©é¢æ¿ (Quick Selection Panel)*

---

## ğŸ“Š Executive Summary

**Feature Overview**: é€šè¿‡çƒ­é”®å”¤èµ·çš„è½»é‡æµ®åŠ¨çª—å£ï¼Œæ”¯æŒæ¨¡ç³Šæœç´¢Promptsã€é”®ç›˜å¯¼èˆªã€ä¸€é”®å¤åˆ¶åˆ°å‰ªè´´æ¿

**Architecture Decision**: âœ… **Tauri çª—å£** (åœ¨GUIè¿›ç¨‹å†…å®ç°)  
**Primary Technology**: HTML/CSS/JavaScript + Rust (Tauri Commands)

---

## ğŸ¯ Domain Model

### **Entities (å®ä½“)**

| Entity | Type | Description | Source |
|--------|------|-------------|--------|
| **Prompt** | Existing | æç¤ºè¯å®ä½“ï¼ˆid, name, content, tags, categoryï¼‰ | Database |
| **SelectionPanel** | New | é€‰æ‹©é¢æ¿ä¸»ç»„ä»¶ | Frontend |
| **SearchEngine** | New | æ¨¡ç³Šæœç´¢å¼•æ“ | Frontend Logic |
| **PromptList** | Computed | è¿‡æ»¤åçš„Promptåˆ—è¡¨ | Derived |
| **FocusedItem** | State | å½“å‰é€‰ä¸­çš„Prompt | UI State |
| **SearchQuery** | State | ç”¨æˆ·è¾“å…¥çš„æœç´¢å…³é”®è¯ | UI State |
| **SelectorHotkey** | Config | è§¦å‘é€‰æ‹©å™¨çš„çƒ­é”®ï¼ˆå¦‚`Ctrl+Shift+P`ï¼‰ | Config |

---

### **Verbs (æ ¸å¿ƒæ“ä½œ)**

| Verb | Actor | Target | Description |
|------|-------|--------|-------------|
| **invoke** | User | SelectorHotkey | æŒ‰ä¸‹çƒ­é”®è§¦å‘é¢æ¿ |
| **show** | System | SelectionPanel | æ˜¾ç¤ºæµ®åŠ¨çª—å£ |
| **query** | SelectionPanel | Database | è·å–æ‰€æœ‰Prompts |
| **search** | SearchEngine | PromptList | æ¨¡ç³Šè¿‡æ»¤Prompts |
| **navigate** | User | FocusedItem | ç”¨â†‘â†“é”®é€‰æ‹©Prompt |
| **select** | User | FocusedItem | å›è½¦ç¡®è®¤é€‰æ‹© |
| **copy** | System | Clipboard | å¤åˆ¶Promptå†…å®¹ |
| **dismiss** | User/System | SelectionPanel | ESCæˆ–å¤±ç„¦å…³é—­ |
| **log** | System | UsageLogs | è®°å½•ç”¨æˆ·é€‰æ‹©è¡Œä¸º |

---

## ğŸ”„ Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚                                                    â”‚ Database â”‚
â””â”€â”€â”€â”¬â”€â”€â”˜                                                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                                                            â”‚
    â”‚ 1. Press Selector Hotkey (Ctrl+Shift+P)                   â”‚
    v                                                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚ HotkeyService â”‚                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
        â”‚                                                        â”‚
        â”‚ 2. Emit IPC event: "show_selector"                    â”‚
        v                                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚ Tauri Main (GUI)  â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
         â”‚                                                       â”‚
         â”‚ 3. Create/Show SelectionPanel Window                 â”‚
         v                                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚           SelectionPanel (Frontend)         â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                 â”‚
â”‚  â”‚ 4. On Mount: fetch prompts         â”‚    â”‚                 â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚                 â”‚
â”‚  â”‚    â”‚ get_all_prompts_for_selector()â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚  5. SELECT *    â”‚
â”‚  â”‚                                     â”‚    â”‚     FROM promptsâ”‚
â”‚  â”‚  prompts: Vec<Prompt> â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                  
â”‚                 â”‚                           â”‚
â”‚                 v                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 6. User types search query: "api"  â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚    â”‚ SearchEngine.filter("api")   â”‚â”‚    â”‚
â”‚  â”‚    â”‚ - Fuzzy match on name + tags â”‚â”‚    â”‚
â”‚  â”‚    â”‚ - Return top 10 results      â”‚â”‚    â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â”‚                                     â”‚    â”‚
â”‚  â”‚  filtered: [{API Call}, {REST...}] â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   v                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 7. UI re-renders with results      â”‚    â”‚
â”‚  â”‚    - Highlight first item (index 0)â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   â”‚                         â”‚
â”‚                   v                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 8. User navigates with â†“â†‘ keys     â”‚    â”‚
â”‚  â”‚    focusedIndex += 1 / -= 1        â”‚    â”‚
â”‚  â”‚    UI updates highlight             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                   v                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 9. User presses Enter               â”‚    â”‚
â”‚  â”‚    onSelect(focusedItem)            â”‚    â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚    â”‚copy_prompt_to_clipboard(...)  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ Clipboard â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚    â”‚
â”‚  â”‚    â”‚log_selector_usage(prompt.id) â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€> Database
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚    â”‚
â”‚  â”‚    panel.hide()                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ State Machine

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Hidden  â”‚ (Initial State)
                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                         â”‚
              hotkey_pressed (Ctrl+Shift+P)
                         â”‚
                         v
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”Œâ”€â†’â”‚ Showing â”‚â—„â”€â”
                 â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚
                 â”‚       â”‚       â”‚
                 â”‚  â”Œâ”€â”€â”€â”€vâ”€â”€â”€â”€â”  â”‚
                 â”‚  â”‚Searchingâ”‚â”€â”€â”˜ (user_types / filter_updates)
                 â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                 â”‚       â”‚
                 â”‚  list_rendered
                 â”‚       â”‚
                 â”‚       v
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  â”‚Navigatingâ”‚ (Up/Down keys update focusedIndex)
                 â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚       â”‚
                 â”‚  Enter_pressed
                 â”‚       â”‚
                 â”‚       v
                 â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  â”‚Confirmingâ”‚
                 â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â”‚       â”‚
                 â”‚    â”Œâ”€â”€â”´â”€â”€â”€â”
                 â”‚    â”‚      v
                 â”‚    â”‚ copy_to_clipboard()
                 â”‚    â”‚ log_usage()
                 â”‚    â”‚      â”‚
                 â”‚    â”‚      v
                 â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                 â””â”€â”€â”€â”€â”¼â”€â”‚ Hidden â”‚
                      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚      ^
                 ESC  â”‚      â”‚
               or     â”‚      â”‚ dismiss_complete
            lose_focusâ”‚      â”‚
                      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                      â””â†’â”‚Dismissingâ”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Component Architecture

### **Frontend Components (HTML/CSS/JS)**

```
SelectionPanel/
â”œâ”€â”€ index.html                # çª—å£HTMLç»“æ„
â”œâ”€â”€ styles.css                # æ ·å¼ï¼ˆç°ä»£åŒ–ã€åŠé€æ˜ï¼‰
â”œâ”€â”€ main.js                   # ä¸»é€»è¾‘
â”‚   â”œâ”€â”€ PanelController       # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ SearchEngine          # æ¨¡ç³Šæœç´¢ï¼ˆä½¿ç”¨ fuse.jsï¼‰
â”‚   â”œâ”€â”€ KeyboardHandler       # é”®ç›˜äº‹ä»¶å¤„ç†
â”‚   â””â”€â”€ UIRenderer            # ç»“æœåˆ—è¡¨æ¸²æŸ“
â””â”€â”€ utils/
    â”œâ”€â”€ clipboard.js          # å‰ªè´´æ¿æ“ä½œå°è£… (è°ƒç”¨Tauri command)
    â””â”€â”€ logger.js             # è®°å½•ç”¨æˆ·è¡Œä¸º
```

### **Backend Integration (Rust)**

```rust
// src/main.rs (æ–°å¢Tauri commands)

#[tauri::command]
fn get_all_prompts_for_selector() -> Result<Vec<Prompt>, String> {
    // ç›´æ¥å¤ç”¨ç°æœ‰çš„æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
    get_all_prompts()
}

#[tauri::command]
fn copy_prompt_to_clipboard(content: String) -> Result<(), String> {
    // æå–å¹¶å¤ç”¨ injector ä¸­çš„å‰ªè´´æ¿ä»£ç 
    clipboard::copy_text(&content)
}

#[tauri::command]
fn log_selector_usage(prompt_id: i32) -> Result<(), String> {
    let conn = open_db()?;
    conn.execute(
        "INSERT INTO usage_logs (prompt_id, action, timestamp) VALUES (?1, 'selector_select', ?2)",
        params![prompt_id, chrono::Utc::now().to_rfc3339()],
    )?;
    Ok(())
}
```

---

## ğŸ”§ Technical Contracts

### **1. Tauri Window Configuration**

```json
{
  "label": "selector-panel",
  "url": "selector.html",
  "width": 600,
  "height": 400,
  "resizable": false,
  "fullscreen": false,
  "decorations": false,        // æ— è¾¹æ¡†çª—å£
  "transparent": true,           // èƒŒæ™¯é€æ˜ï¼ˆæ”¯æŒåœ†è§’ï¼‰
  "alwaysOnTop": true,
  "center": true,
  "focus": true,
  "skipTaskbar": true            // ä¸åœ¨ä»»åŠ¡æ æ˜¾ç¤º
}
```

### **2. Fuzzy Search Specification**

**Library**: `fuse.js` (å‰ç«¯)

**Configuration**:
```javascript
const fuseOptions = {
  keys: ['name', 'tags', 'category'],  // æœç´¢å­—æ®µ
  threshold: 0.3,                       // åŒ¹é…é˜ˆå€¼ (0=å®Œå…¨åŒ¹é…, 1=åŒ¹é…ä»»ä½•)
  includeScore: true,                   // è¿”å›ç›¸å…³æ€§åˆ†æ•°
  minMatchCharLength: 2,                // æœ€å°åŒ¹é…å­—ç¬¦æ•°
  ignoreLocation: true                  // å¿½ç•¥ä½ç½®æƒé‡
};

const fuse = new Fuse(prompts, fuseOptions);
const results = fuse.search(query).slice(0, 10);  // æœ€å¤šè¿”å›10ä¸ª
```

### **3. Keyboard Event Handling**

| Key | Action | Implementation |
|-----|--------|----------------|
| `â†‘` | å‘ä¸Šå¯¼èˆª | `focusedIndex = Math.max(0, focusedIndex - 1)` |
| `â†“` | å‘ä¸‹å¯¼èˆª | `focusedIndex = Math.min(results.length - 1, focusedIndex + 1)` |
| `Enter` | ç¡®è®¤é€‰æ‹© | `handleSelect(results[focusedIndex])` |
| `ESC` | å…³é—­é¢æ¿ | `window.close()` or `appWindow.hide()` |
| `Ctrl+N` | å‘ä¸‹å¯¼èˆª (å¯é€‰) | åŒ `â†“` |
| `Ctrl+P` | å‘ä¸Šå¯¼èˆª (å¯é€‰) | åŒ `â†‘` |

---

## ğŸŒ‘ Dark Matter Components (éšæ€§éœ€æ±‚)

### **1. Configuration (é…ç½®ç®¡ç†)**

**New Config Section** (`config.yaml`):
```yaml
selector:
  hotkey: "Ctrl+Shift+P"      # è§¦å‘çƒ­é”®ï¼ˆåŒºåˆ«äºæ³¨å…¥çƒ­é”®ï¼‰
  window:
    width: 600
    height: 400
    max_results: 10            # æœ€å¤šæ˜¾ç¤ºç»“æœæ•°
  search:
    threshold: 0.3             # æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼
    min_query_length: 0        # æœ€å°æœç´¢å­—ç¬¦æ•°ï¼ˆ0=æ˜¾ç¤ºå…¨éƒ¨ï¼‰
  behavior:
    auto_close_on_blur: true   # å¤±ç„¦æ—¶è‡ªåŠ¨å…³é—­
    remember_last_query: false # æ˜¯å¦è®°ä½ä¸Šæ¬¡æœç´¢è¯
```

---

### **2. Error Handling (é”™è¯¯å¤„ç†)**

| Error Scenario | Handling Strategy |
|----------------|-------------------|
| æ•°æ®åº“æŸ¥è¯¢å¤±è´¥ | æ˜¾ç¤ºé”™è¯¯æç¤º "æ— æ³•åŠ è½½æç¤ºè¯ï¼Œè¯·é‡å¯åº”ç”¨" |
| æ— ä»»ä½•Prompt | æ˜¾ç¤ºç©ºçŠ¶æ€ "è¿˜æ²¡æœ‰æç¤ºè¯ï¼Œè¯·å…ˆåˆ›å»º" |
| å‰ªè´´æ¿å†™å…¥å¤±è´¥ | Toasté€šçŸ¥ "å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶" |
| çª—å£åˆ›å»ºå¤±è´¥ | é™çº§åˆ°é€šçŸ¥æ æç¤º or fallbackåˆ°ä¸»çª—å£ |

---

### **3. Hotkey Integration (çƒ­é”®é›†æˆ)**

**Challenge**: å½“å‰ `HotkeyService` åªæ”¯æŒå•ä¸€çƒ­é”®

**Solution A** (æ¨è): æ‰©å±• HotkeyService æ”¯æŒå¤šçƒ­é”®
```rust
// service/src/hotkey/mod.rs
pub enum HotkeyAction {
    TriggerInjection,
    ShowSelector,
}

impl HotkeyService {
    pub fn register_multiple(&mut self, hotkeys: Vec<(String, HotkeyAction)>) { ... }
}
```

**Solution B**: ä½¿ç”¨ä¸åŒçš„ Hotkey ID
```rust
// æ³¨å…¥çƒ­é”®: ID=1
// é€‰æ‹©å™¨çƒ­é”®: ID=2
RegisterHotKey(hwnd, 1, MOD_CONTROL | MOD_ALT, VK_SPACE);
RegisterHotKey(hwnd, 2, MOD_CONTROL | MOD_SHIFT, VK_P);
```

**IPC Event**:
```rust
// å½“Serviceæ£€æµ‹åˆ°é€‰æ‹©å™¨çƒ­é”®è¢«æŒ‰ä¸‹
if hotkey_id == 2 {
    // é€šè¿‡æŸç§IPCæœºåˆ¶é€šçŸ¥GUIè¿›ç¨‹
    // Option 1: å†™å…¥å…±äº«å†…å­˜
    // Option 2: TCP/UDPæœ¬åœ°é€šä¿¡
    // Option 3: Named Pipe (æ¨èWindowså¹³å°)
}
```

---

### **4. Window Lifecycle Management (çª—å£ç”Ÿå‘½å‘¨æœŸ)**

**Creation Strategy**: 
- **Lazy Creation**: é¦–æ¬¡æŒ‰çƒ­é”®æ—¶åˆ›å»ºçª—å£ï¼ˆå¯åŠ¨å¿«ï¼‰
- **Pre-Creation**: åº”ç”¨å¯åŠ¨æ—¶é¢„åˆ›å»ºä½†éšè—ï¼ˆå“åº”å¿«ï¼‰

**Recommendation**: âœ… **Lazy Creation** (é¦–æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºï¼Œåç»­åªæ˜¯show/hide)

**Memory Management**:
```javascript
// å…³é—­æ—¶ä¸é”€æ¯ï¼Œåªæ˜¯éšè—
window.addEventListener('blur', () => {
    if (config.auto_close_on_blur) {
        appWindow.hide();  // è€Œä¸æ˜¯ close()
    }
});
```

---

### **5. Performance Optimization (æ€§èƒ½ä¼˜åŒ–)**

| Metric | Target | Strategy |
|--------|--------|----------|
| çª—å£å¯åŠ¨æ—¶é—´ | <200ms | Lazy creation + Pre-load prompts cache |
| æœç´¢å»¶è¿Ÿ | <50ms | Debounce user input (100ms) + fuse.js |
| æœ€å¤§æ”¯æŒPrompts | 1000+ | å‰ç«¯åˆ†é¡µ or è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¦‚è¶…è¿‡100é¡¹ï¼‰|
| å†…å­˜å ç”¨ | <100MB | Tauriçª—å£çš„åˆç†èŒƒå›´ï¼ˆ1ä¸ªWebviewï¼‰|

**Debounce Implementation**:
```javascript
let searchTimeout;
function handleSearchInput(query) {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        performSearch(query);  // 100msåæ‰æ‰§è¡Œæœç´¢
    }, 100);
}
```

---

### **6. Logging & Analytics (æ—¥å¿—ä¸åˆ†æ)**

**Usage Metrics to Track**:
```sql
-- æ–°å¢å­—æ®µåˆ° usage_logs è¡¨
ALTER TABLE usage_logs ADD COLUMN action VARCHAR(50);  -- 'selector_select', 'inject', etc.
ALTER TABLE usage_logs ADD COLUMN query VARCHAR(255);  -- ç”¨æˆ·æœç´¢çš„å…³é”®è¯
```

**Analytics Questions**:
- å“ªä¸ªPromptæœ€å¸¸é€šè¿‡é€‰æ‹©å™¨ä½¿ç”¨ï¼Ÿ
- ç”¨æˆ·å¹³å‡æœç´¢å‡ ä¸ªå­—ç¬¦åé€‰æ‹©ï¼Ÿ
- é€‰æ‹©å™¨ä½¿ç”¨é¢‘ç‡ vs ç›´æ¥æ³¨å…¥çƒ­é”®ï¼Ÿ

---

### **7. Accessibility (è¾…åŠ©åŠŸèƒ½)**

| Feature | Priority | Implementation |
|---------|----------|----------------|
| é”®ç›˜å®Œå…¨æ“ä½œ | âœ… P0 | å·²è§„åˆ’ï¼ˆUp/Down/Enter/ESCï¼‰|
| é¼ æ ‡ç‚¹å‡»æ”¯æŒ | âš ï¸ P1 | æ·»åŠ  onClick äº‹ä»¶åˆ°åˆ—è¡¨é¡¹ |
| å±å¹•é˜…è¯»å™¨ | âŒ P2 | ARIAæ ‡ç­¾ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰|
| é«˜å¯¹æ¯”åº¦æ¨¡å¼ | âŒ P2 | æœªæ¥ä¼˜åŒ– |

---

## ğŸ”Œ Integration Points

### **ä¸ç°æœ‰ç³»ç»Ÿçš„é›†æˆ**

| Component | Interaction | Coupling | Notes |
|-----------|-------------|----------|-------|
| **Database** | `get_all_prompts_for_selector()` | âœ… Low (åªè¯»æŸ¥è¯¢) | å¤ç”¨ç°æœ‰SQLé€»è¾‘ |
| **HotkeyService** | æ³¨å†Œé€‰æ‹©å™¨çƒ­é”® | âš ï¸ Medium (éœ€æ‰©å±•API) | éœ€è¦æ”¯æŒå¤šçƒ­é”® |
| **Config** | è¯»å– `selector.*` é…ç½® | âœ… Low | æ·»åŠ æ–°é…ç½®é¡¹ |
| **Clipboard** | `copy_prompt_to_clipboard()` | âœ… Low | æå–injectorä»£ç ä¸ºç‹¬ç«‹å‡½æ•° |
| **UsageLogs** | è®°å½•é€‰æ‹©è¡Œä¸º | âœ… Low | å¤ç”¨ç°æœ‰æ—¥å¿—è¡¨ |
| **Main Window** | IPCé€šä¿¡ | âš ï¸ Medium | Service â†’ GUIäº‹ä»¶ä¼ é€’ |

---

## ğŸ“¦ Missing Components Identified

æ ¹æ® Jake Nations æ–¹æ³•è®ºï¼Œä»¥ä¸‹æ˜¯å¯èƒ½è¢«å¿½ç•¥çš„ç»„ä»¶ï¼š

| Component | Status | Priority | Action |
|-----------|--------|----------|--------|
| **Clipboard Module** | âŒ Missing | P0 | å°†injectorçš„clipboardä»£ç æå–ä¸ºç‹¬ç«‹æ¨¡å— |
| **IPC Event Bus** | âŒ Missing | P0 | Serviceå’ŒGUIé—´çš„äº‹ä»¶é€šä¿¡æœºåˆ¶ |
| **Hotkey Conflict Handler** | âŒ Missing | P1 | çƒ­é”®è¢«å ç”¨æ—¶çš„fallback |
| **Window Focus Manager** | âŒ Missing | P1 | ç¡®ä¿çª—å£æ˜¾ç¤ºåè‡ªåŠ¨è·å–ç„¦ç‚¹ |
| **Search Indexing** | âŒ Missing | P2 | å¯¹å¤§é‡Promptsåšç´¢å¼•ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰|
| **Theme System** | âŒ Missing | P2 | æ”¯æŒäº®/æš—ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰|
| **Keyboard Shortcuts Config** | âŒ Missing | P2 | å…è®¸ç”¨æˆ·è‡ªå®šä¹‰å¿«æ·é”®ï¼ˆæœªæ¥ï¼‰|

---

## ğŸ¯ Development Phases

### **Phase 1: MVP (Minimum Viable Product)**

âœ… **Must Have**:
1. Tauriçª—å£åŸºç¡€è®¾æ–½ï¼ˆåˆ›å»º/æ˜¾ç¤º/éšè—ï¼‰
2. ä»æ•°æ®åº“åŠ è½½Prompts
3. ç®€å•åˆ—è¡¨å±•ç¤º
4. â†‘â†“é”®å¯¼èˆª
5. Enteré”®å¤åˆ¶åˆ°å‰ªè´´æ¿
6. ESCå…³é—­

âš ï¸ **Nice to Have**:
- æ¨¡ç³Šæœç´¢ï¼ˆå¯å…ˆç”¨ç®€å•çš„String.includesï¼‰

---

### **Phase 2: Enhanced UX**

âœ… **Features**:
1. é›†æˆ fuse.js æ¨¡ç³Šæœç´¢
2. é«˜äº®æœç´¢å…³é”®è¯
3. æ˜¾ç¤ºPrompté¢„è§ˆï¼ˆå‰50å­—ç¬¦ï¼‰
4. å¤±ç„¦è‡ªåŠ¨å…³é—­
5. ç¾åŒ–UIï¼ˆæ¸å˜ã€é˜´å½±ã€åŠ¨ç”»ï¼‰

---

### **Phase 3: Polish & Analytics**

âœ… **Features**:
1. Usage logging (è®°å½•é€‰æ‹©è¡Œä¸º)
2. æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰
3. é…ç½®ç•Œé¢ï¼ˆåœ¨ä¸»çª—å£è®¾ç½®é€‰æ‹©å™¨çƒ­é”®ï¼‰
4. é¼ æ ‡ç‚¹å‡»æ”¯æŒ

---

## ğŸš€ Architecture Recommendation

**Recommended Approach**: ğŸ¯ **Tauri Multi-Window**

**Rationale**:
1. âœ… å¿«é€Ÿå¼€å‘ï¼ˆå¤ç”¨ç°æœ‰HTML/CSS/JSæŠ€èƒ½ï¼‰
2. âœ… æ˜“äºç¾åŒ–ï¼ˆCSSåŠ¨ç”»ã€åŠé€æ˜æ•ˆæœï¼‰
3. âœ… è·¨å¹³å°æ½œåŠ›ï¼ˆè™½ç„¶å½“å‰åªæ”¯æŒWindowsï¼‰
4. âœ… ä¸ä¸»çª—å£å…±äº«Tauri runtimeï¼ˆå†…å­˜æ•ˆç‡ï¼‰

**Alternative Rejected**: Native Win32 + Webview2
- âŒ å¼€å‘å¤æ‚åº¦è¿‡é«˜
- âŒ ä¸å€¼å¾—ä¸ºè¿™ä¸ªåŠŸèƒ½æŠ•å…¥å¤§é‡Win32å­¦ä¹ æˆæœ¬

---

## ğŸ“ Next Steps (To Planning Phase)

- âœ… **Step 5 Complete**: Concept Model Defined
- ğŸ”œ **Step 6**: Interactive Q&A with User (ç¡®è®¤æ¨¡å‹å‡†ç¡®æ€§)
- ğŸ”œ **Step 7**: Generate Final System Context Report
- ğŸ”œ **Step 8**: Transition to `/blueprint` workflow (è®¾è®¡æŠ€æœ¯æ–¹æ¡ˆ)

---

*End of Concept Model Report*
